var gisRegion;!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.MarkerDrawer=t():e.MarkerDrawer=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(n){if(a[n])return a[n].exports;var r=a[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var a={};return t.m=e,t.c=a,t.d=function(e,a,n){t.o(e,a)||Object.defineProperty(e,a,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(a,"a",a),a},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/dist/",t(t.s=0)}([function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(1);a.d(t,"MarkerDrawer",function(){return n.a});var r=a(6);a.d(t,"Atlas",function(){return r.a})},function(e,t,a){"use strict";a.d(t,"a",function(){return i});var n=a(2),r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),i=function(e){function t(t){void 0===t&&(t={});var a=e.call(this)||this;return a._onClick=function(e){if(a._map){var t=a._getMousePosition(e),n=a._renderer.search(t);if(a.onClickAny&&a.onClickAny(e),n.length){a.onClickMarker&&a.onClickMarker(e),e.stopPropagation();var r={originalEvent:e,marker:Math.max.apply(Math,n)};a.fire("click",r)}}},a._onMouseLeave=function(e){if(void 0!==a._hoveredMarker){var t={originalEvent:e,marker:a._hoveredMarker};a.fire("mouseout",t),a._hoveredMarker=void 0}},a._onMouseMove=function(e){var t=a._getMousePosition(e),n=a._renderer.search(t),r={originalEvent:e,marker:0};if(n.length){var i=Math.max.apply(Math,n);if(void 0!==a._hoveredMarker){if(a._hoveredMarker===i)return;r.marker=a._hoveredMarker,a.fire("mouseout",r)}a._hoveredMarker=i,r.marker=a._hoveredMarker,a.fire("mouseover",r)}else void 0!==a._hoveredMarker&&(r.marker=a._hoveredMarker,a.fire("mouseout",r),a._hoveredMarker=void 0)},a._onMouseDown=function(e){var t=a._getMousePosition(e),n=a._renderer.search(t);if(n.length){a._clickedMarker=Math.max.apply(Math,n);var r={originalEvent:e,marker:a._clickedMarker};a.fire("mousedown",r)}},a._onMouseUp=function(e){if(void 0!==a._clickedMarker){var t={originalEvent:e,marker:a._clickedMarker};a.fire("mouseup",t),a._clickedMarker=void 0}},a.onClickMarker=t.onClickMarker,a.onClickAny=t.onClickAny,a._renderer=new n.a(a,t.debugDrawing||!1,void 0!==t.bufferFactor?t.bufferFactor:.5,t.zIndex,t.updateOnMoveEnd),a}return r(t,e),t.prototype.setAtlas=function(e){this._renderer.setAtlas(e)},t.prototype.setMarkers=function(e){this._renderer.setMarkers(e)},t.prototype.update=function(){this._renderer.update()},t.prototype.addTo=function(e){return e.addLayer(this),this},t.prototype.onAdd=function(){return this._map?(this._pane=this._map.getPane("overlayPane"),this._renderer.onAddToMap(this._map),this._pane.addEventListener("click",this._onClick,!0),this._pane.addEventListener("mousemove",this._onMouseMove),this._pane.addEventListener("mouseleave",this._onMouseLeave),this._pane.addEventListener("mousedown",this._onMouseDown),this._pane.addEventListener("mouseup",this._onMouseUp),this._pane.appendChild(this._renderer.container),this):this},t.prototype.remove=function(){return this._map&&this._map.removeLayer(this),this},t.prototype.onRemove=function(){return this._pane.removeChild(this._renderer.container),this._renderer.onRemoveFromMap(),this._pane.removeEventListener("click",this._onClick),this._pane.removeEventListener("mousemove",this._onMouseMove),this._pane.removeEventListener("mouseleave",this._onMouseLeave),this._pane.removeEventListener("mousedown",this._onMouseDown),this._pane.removeEventListener("mouseup",this._onMouseUp),this},t.prototype.setDebugDrawing=function(e){this._renderer.setDebugDrawing(e)},t.prototype.emulateClickMarker=function(e){this._onClick(e)},t.prototype._getMousePosition=function(e){var t=this._map.getContainer(),a=t.getBoundingClientRect();return[e.clientX-a.left-t.clientLeft,e.clientY-a.top-t.clientTop]},t}(L.Layer)},function(e,t,a){"use strict";a.d(t,"a",function(){return i});var n=a(3),r=(a.n(n),a(5)),i=function(){function e(e,t,a,n,i){void 0===i&&(i=!0);var o=this;this.update=function(){if(o._map){if(o._isRendering||o._isZooming)return void(o._needUpdate=!0);o._zoom=o._map.getZoom();var e=o._map.getCenter();Object(r.a)(o._origin,[e.lng,e.lat],o._zoom),o._origin[0]-=o._mapSize[0]/2,o._origin[1]-=o._mapSize[1]/2;var t=o._map.containerPointToLayerPoint([-o._bufferOffset[0],-o._bufferOffset[1]]).round();L.DomUtil.setPosition(o._hiddenFrame.canvas,t),o._render()}},this._onResize=function(){if(o._map){var e=o._map.getSize();o._pixelRatio=Math.min(Math.floor(window.devicePixelRatio),3),o._bufferOffset=[Math.round(e.x*o._bufferFactor),Math.round(e.y*o._bufferFactor)];var t=o._size=[e.x+2*o._bufferOffset[0],e.y+2*o._bufferOffset[1]];o._mapSize=[e.x,e.y],o._currentFrame.canvas.width=t[0]*o._pixelRatio,o._currentFrame.canvas.height=t[1]*o._pixelRatio,o._currentFrame.canvas.style.width=t[0]+"px",o._currentFrame.canvas.style.height=t[1]+"px",o._hiddenFrame.canvas.width=t[0]*o._pixelRatio,o._hiddenFrame.canvas.height=t[1]*o._pixelRatio,o._hiddenFrame.canvas.style.width=t[0]+"px",o._hiddenFrame.canvas.style.height=t[1]+"px"}},this._onZoomStart=function(){o.clear(),o._isZooming=!0},this._onMoveEnd=function(){o._isZooming=!1,o._updateOnMoveEnd&&o.update()},this._onMoveStart=function(){o._stopRendering()},this._renderLoop=function(){var e=o._lastRenderedMarker,t=Math.min(e+o._markersPerFrame,o._markers.length);if(e!==t){var a=Object(r.b)();o._renderPart(e,t),o._lastRenderedMarker=t;var n=(Object(r.b)()-a)/(t-e);if(0!==n){var i=o._timePerFrame/n;o._markersPerFrame=Math.max(o._markersPerFrame+Math.floor((i-o._markersPerFrame)/5),100)}t!==o._markers.length?o._requestAnimationFrameId=requestAnimationFrame(o._renderLoop):o._renderFinish()}else o._renderFinish()},this.md=e,this._markers=[],this._markersData=[],this._isZooming=!1,this._debugDrawing=t,this._bufferFactor=a,this._updateOnMoveEnd=i,this._markersPerFrame=500,this._timePerFrame=10,this._origin=Object(r.c)(),this._vec=Object(r.c)(),this._lastRenderedMarker=0,this._needUpdate=!1,this.container=document.createElement("div"),n&&(this.container.style["z-index"]=n),this.container.style.position="absolute",this._currentFrame=this._createFrame(),this._hiddenFrame=this._createFrame()}return e.prototype.setAtlas=function(e){var t=this;e&&(this._atlas=e,this._atlas.whenReady().then(function(){t.update()}))},e.prototype.setMarkers=function(e){if(this._needUpdate=!1,this._stopRendering(),e.length>this._markersData.length){for(var t=[],a=0;a<e.length;a++)t[a]={index:a};this._markersData=t}this._markers=e,this.update()},e.prototype.onAddToMap=function(e){this._map=e,e.on({viewreset:this.update,movestart:this._onMoveStart,moveend:this._onMoveEnd,zoomstart:this._onZoomStart,resize:this._onResize}),this._onResize()},e.prototype.onRemoveFromMap=function(){this._map&&(this._map.off({viewreset:this.update,movestart:this._onMoveStart,moveend:this._onMoveEnd,zoomstart:this._onZoomStart,resize:this._onResize}),this._map=void 0,this._markersData=[],this._markers=[])},e.prototype.clear=function(){this._map&&(this._currentFrame.canvas.style.display="none",this._currentFrame.ctx.clearRect(0,0,this._size[0]*this._pixelRatio,this._size[1]*this._pixelRatio),this._currentFrame.tree.clear(),this._needUpdate=!1,this._isRendering&&(cancelAnimationFrame(this._requestAnimationFrameId),this._isRendering=!1))},e.prototype.search=function(e){var t=(e[0]+this._bufferOffset[0])*this._pixelRatio,a=(e[1]+this._bufferOffset[1])*this._pixelRatio;return this._currentFrame.tree.search({minX:t,minY:a,maxX:t,maxY:a}).map(function(e){return e.index})},e.prototype.setDebugDrawing=function(e){this._debugDrawing=e},e.prototype._stopRendering=function(){this._isRendering&&(cancelAnimationFrame(this._requestAnimationFrameId),this._isRendering=!1)},e.prototype._render=function(){this._map&&(this._hiddenFrame.tree.clear(),this._hiddenFrame.ctx.clearRect(0,0,this._size[0]*this._pixelRatio,this._size[1]*this._pixelRatio),this._isRendering=!0,this._lastRenderedMarker=0,this._renderLoop())},e.prototype._renderFinish=function(){this._isRendering=!1,this._switchFrames(),this._needUpdate&&(this._needUpdate=!1,this.update())},e.prototype._renderPart=function(e,t){var a=this._markers,n=this._markersData,i=this._atlas,o=this._debugDrawing,s=this._pixelRatio,c=this._size,l=this._hiddenFrame.ctx,u=this._vec,d=this._zoom,p=this._origin,h=this._bufferOffset;if(i.image){this._lastRenderedMarker=t;for(var m=[],f=e;f<t;f++){var g=a[f],v=n[f],_=i.sprites[g.iconIndex||0];if(_){var y=s/_.pixelDensity;if(Object(r.a)(u,g.position,d),u[0]=Math.round(u[0]),u[1]=Math.round(u[1]),u[0]=Math.round(u[0]-p[0])+h[0],u[1]=Math.round(u[1]-p[1])+h[1],u[0]=Math.round(u[0]*s-_.size[0]*y*_.anchor[0]),u[1]=Math.round(u[1]*s-_.size[1]*y*_.anchor[1]),!(u[0]<0||u[0]+_.size[0]*y>c[0]*s||u[1]<0||u[1]+_.size[1]*y>c[1]*s)){var M=_.interactiveMargin*y;v.minX=u[0]-M,v.minY=u[1]-M,v.maxX=u[0]+_.size[0]*y+M,v.maxY=u[1]+_.size[1]*y+M,m.push(v),l.drawImage(i.image,_.position[0],_.position[1],_.size[0],_.size[1],u[0],u[1],_.size[0]*y,_.size[1]*y),o&&this._debugDraw(g,u,_.size)}}}this._hiddenFrame.tree.load(m)}},e.prototype._debugDraw=function(e,t,a){var n=this._hiddenFrame.ctx,r=["#000000","#ff0000","#00ff00","#0000ff"],i=e.drawingOffsets;if(i)for(var o=0;o<i.length;o++){var s=i[o];n.beginPath(),n.strokeStyle=r[o],n.rect(t[0]-s,t[1]-s,a[0]+2*s,a[1]+2*s),n.stroke()}},e.prototype._createFrame=function(){var e=this,t=document.createElement("canvas");t.style.display="none",t.style.position="initial";var a=t.getContext("2d"),r=n();return t.addEventListener("click",function(t){var a=t.target;if(a.parentElement){var n=a.parentElement;if(n.parentElement&&n.parentElement)return e.md.emulateClickMarker(t),!0}},!1),this.container.appendChild(t),{canvas:t,ctx:a,tree:r}},e.prototype._switchFrames=function(){if(this._map){this._currentFrame.canvas.style.display="none",this._hiddenFrame.canvas.style.display="block";var e=this._currentFrame;this._currentFrame=this._hiddenFrame,this._hiddenFrame=e}},e}()},function(e,t,a){"use strict";function n(e,t){if(!(this instanceof n))return new n(e,t);this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&this._initFormat(t),this.clear()}function r(e,t,a){if(!a)return t.indexOf(e);for(var n=0;n<t.length;n++)if(a(e,t[n]))return n;return-1}function i(e,t){o(e,0,e.children.length,t,e)}function o(e,t,a,n,r){r||(r=g(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var i,o=t;o<a;o++)i=e.children[o],s(r,e.leaf?n(i):i);return r}function s(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function c(e,t){return e.minX-t.minX}function l(e,t){return e.minY-t.minY}function u(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function d(e){return e.maxX-e.minX+(e.maxY-e.minY)}function p(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function h(e,t){var a=Math.max(e.minX,t.minX),n=Math.max(e.minY,t.minY),r=Math.min(e.maxX,t.maxX),i=Math.min(e.maxY,t.maxY);return Math.max(0,r-a)*Math.max(0,i-n)}function m(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function f(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function g(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function v(e,t,a,n,r){for(var i,o=[t,a];o.length;)(a=o.pop())-(t=o.pop())<=n||(i=t+Math.ceil((a-t)/n/2)*n,_(e,i,t,a,r),o.push(t,i,i,a))}e.exports=n,e.exports.default=n;var _=a(4);n.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,a=[],n=this.toBBox;if(!f(e,t))return a;for(var r,i,o,s,c=[];t;){for(r=0,i=t.children.length;r<i;r++)o=t.children[r],f(e,s=t.leaf?n(o):o)&&(t.leaf?a.push(o):m(e,s)?this._all(o,a):c.push(o));t=c.pop()}return a},collides:function(e){var t=this.data,a=this.toBBox;if(!f(e,t))return!1;for(var n,r,i,o,s=[];t;){for(n=0,r=t.children.length;n<r;n++)if(i=t.children[n],f(e,o=t.leaf?a(i):i)){if(t.leaf||m(e,o))return!0;s.push(i)}t=s.pop()}return!1},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0,a=e.length;t<a;t++)this.insert(e[t]);return this}var n=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},insert:function(e){return e&&this._insert(e,this.data.height-1),this},clear:function(){return this.data=g([]),this},remove:function(e,t){if(!e)return this;for(var a,n,i,o,s=this.data,c=this.toBBox(e),l=[],u=[];s||l.length;){if(s||(s=l.pop(),n=l[l.length-1],a=u.pop(),o=!0),s.leaf&&-1!==(i=r(e,s.children,t)))return s.children.splice(i,1),l.push(s),this._condense(l),this;o||s.leaf||!m(s,c)?n?(a++,s=n.children[a],o=!1):s=null:(l.push(s),u.push(a),a=0,n=s,s=s.children[0])}return this},toBBox:function(e){return e},compareMinX:c,compareMinY:l,toJSON:function(){return this.data},fromJSON:function(e){return this.data=e,this},_all:function(e,t){for(var a=[];e;)e.leaf?t.push.apply(t,e.children):a.push.apply(a,e.children),e=a.pop();return t},_build:function(e,t,a,n){var r,o=a-t+1,s=this._maxEntries;if(o<=s)return i(r=g(e.slice(t,a+1)),this.toBBox),r;n||(n=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,n-1))),(r=g([])).leaf=!1,r.height=n;var c,l,u,d,p=Math.ceil(o/s),h=p*Math.ceil(Math.sqrt(s));for(v(e,t,a,h,this.compareMinX),c=t;c<=a;c+=h)for(v(e,c,u=Math.min(c+h-1,a),p,this.compareMinY),l=c;l<=u;l+=p)d=Math.min(l+p-1,u),r.children.push(this._build(e,l,d,n-1));return i(r,this.toBBox),r},_chooseSubtree:function(e,t,a,n){for(var r,i,o,s,c,l,d,h;n.push(t),!t.leaf&&n.length-1!==a;){for(d=h=1/0,r=0,i=t.children.length;r<i;r++)c=u(o=t.children[r]),(l=p(e,o)-c)<h?(h=l,d=c<d?c:d,s=o):l===h&&c<d&&(d=c,s=o);t=s||t.children[0]}return t},_insert:function(e,t,a){var n=this.toBBox,r=a?e:n(e),i=[],o=this._chooseSubtree(r,this.data,t,i);for(o.children.push(e),s(o,r);t>=0&&i[t].children.length>this._maxEntries;)this._split(i,t),t--;this._adjustParentBBoxes(r,i,t)},_split:function(e,t){var a=e[t],n=a.children.length,r=this._minEntries;this._chooseSplitAxis(a,r,n);var o=this._chooseSplitIndex(a,r,n),s=g(a.children.splice(o,a.children.length-o));s.height=a.height,s.leaf=a.leaf,i(a,this.toBBox),i(s,this.toBBox),t?e[t-1].children.push(s):this._splitRoot(a,s)},_splitRoot:function(e,t){this.data=g([e,t]),this.data.height=e.height+1,this.data.leaf=!1,i(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,a){var n,r,i,s,c,l,d,p;for(l=d=1/0,n=t;n<=a-t;n++)s=h(r=o(e,0,n,this.toBBox),i=o(e,n,a,this.toBBox)),c=u(r)+u(i),s<l?(l=s,p=n,d=c<d?c:d):s===l&&c<d&&(d=c,p=n);return p},_chooseSplitAxis:function(e,t,a){var n=e.leaf?this.compareMinX:c,r=e.leaf?this.compareMinY:l;this._allDistMargin(e,t,a,n)<this._allDistMargin(e,t,a,r)&&e.children.sort(n)},_allDistMargin:function(e,t,a,n){e.children.sort(n);var r,i,c=this.toBBox,l=o(e,0,t,c),u=o(e,a-t,a,c),p=d(l)+d(u);for(r=t;r<a-t;r++)i=e.children[r],s(l,e.leaf?c(i):i),p+=d(l);for(r=a-t-1;r>=t;r--)i=e.children[r],s(u,e.leaf?c(i):i),p+=d(u);return p},_adjustParentBBoxes:function(e,t,a){for(var n=a;n>=0;n--)s(t[n],e)},_condense:function(e){for(var t,a=e.length-1;a>=0;a--)0===e[a].children.length?a>0?(t=e[a-1].children).splice(t.indexOf(e[a]),1):this.clear():i(e[a],this.toBBox)},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}},function(e,t,a){e.exports=function(){"use strict";function e(a,n,r,i,o){for(;i>r;){if(i-r>600){var s=i-r+1,c=n-r+1,l=Math.log(s),u=.5*Math.exp(2*l/3),d=.5*Math.sqrt(l*u*(s-u)/s)*(c-s/2<0?-1:1);e(a,n,Math.max(r,Math.floor(n-c*u/s+d)),Math.min(i,Math.floor(n+(s-c)*u/s+d)),o)}var p=a[n],h=r,m=i;for(t(a,r,n),o(a[i],p)>0&&t(a,r,i);h<m;){for(t(a,h,m),h++,m--;o(a[h],p)<0;)h++;for(;o(a[m],p)>0;)m--}0===o(a[r],p)?t(a,r,m):t(a,++m,i),m<=n&&(r=m+1),n<=m&&(i=m-1)}}function t(e,t,a){var n=e[t];e[t]=e[a],e[a]=n}function a(e,t){return e<t?-1:e>t?1:0}return function(t,n,r,i,o){e(t,n,r||0,i||t.length-1,o||a)}}()},function(e,t,a){"use strict";t.c=function(){return new Float64Array(2)},t.a=function(e,t,a){(function(e,t){var a=Math.PI/180,i=Math.max(Math.min(r,t[1]),-r),o=Math.sin(i*a);e[0]=n*t[0]*a,e[1]=n*Math.log((1+o)/(1-o))/2})(e,t),function(e,t,a){var r=256*Math.pow(2,a),i=.5/(Math.PI*n);e[0]=r*(i*t[0]+.5),e[1]=r*(-i*t[1]+.5)}(e,e,a)},a.d(t,"b",function(){return i});var n=6378137,r=85.0511287798,i=window.performance&&window.performance.now?performance.now.bind(performance):Date.now.bind(Date)},function(e,t,a){"use strict";a.d(t,"a",function(){return r});var n=a(7),r=(a.n(n),function(){function e(e){var t=this;this.sprites=[],this._promise=Promise.all(e.map(function(e){return t._imageLoad(e.image)})).then(function(){return t._createSprite(e)})}return e.prototype.whenReady=function(){return this._promise},e.prototype._imageLoad=function(e){return e.complete?Promise.resolve():new Promise(function(t){e.addEventListener("load",t)})},e.prototype._createSprite=function(e){var t=e.map(function(e){var t=[e.image.width,e.image.height],a=e.size||t;return{width:a[0]+4,height:a[1]+4,image:e.image,anchor:e.anchor||[.5,.5],size:a,imageSize:t,interactiveMargin:e.interactiveMargin||0,pixelDensity:e.pixelDensity||1}}),a=n(t,{inPlace:!0});this.size=[a.width,a.height],this.sprites=t.map(function(e){return{position:[e.x+2,e.y+2],size:e.size,anchor:e.anchor,interactiveMargin:e.interactiveMargin,pixelDensity:e.pixelDensity}});var r=this.image=document.createElement("canvas"),i=r.getContext("2d");i&&(r.width=a.width,r.height=a.height,i.shadowColor="transparent",i.shadowBlur=0,t.forEach(function(e){i.drawImage(e.image,0,0,e.imageSize[0],e.imageSize[1],e.x+2,e.y+2,e.size[0],e.size[1])}))},e}())},function(e,t,a){"use strict";var n=a(8);e.exports=function(e,t){t=t||{};var a=new n,r=t.inPlace||!1,i=e.map(function(e){return r?e:{width:e.width,height:e.height,item:e}});i=i.sort(function(e,t){return t.width*t.height-e.width*e.height}),a.fit(i);var o={width:i.reduce(function(e,t){return Math.max(e,t.x+t.width)},0),height:i.reduce(function(e,t){return Math.max(e,t.y+t.height)},0)};return r||(o.items=i),o}},function(e,t){var a=function(){};a.prototype={fit:function(e){var t,a,n,r,i=e.length,o=i>0?e[0].width:0,s=i>0?e[0].height:0;for(this.root={x:0,y:0,width:o,height:s},t=0;t<i;t++)n=e[t],(a=this.findNode(this.root,n.width,n.height))?(r=this.splitNode(a,n.width,n.height),n.x=r.x,n.y=r.y):(r=this.growNode(n.width,n.height),n.x=r.x,n.y=r.y)},findNode:function(e,t,a){return e.used?this.findNode(e.right,t,a)||this.findNode(e.down,t,a):t<=e.width&&a<=e.height?e:null},splitNode:function(e,t,a){return e.used=!0,e.down={x:e.x,y:e.y+a,width:e.width,height:e.height-a},e.right={x:e.x+t,y:e.y,width:e.width-t,height:a},e},growNode:function(e,t){var a=e<=this.root.width,n=t<=this.root.height,r=n&&this.root.height>=this.root.width+e,i=a&&this.root.width>=this.root.height+t;return r?this.growRight(e,t):i?this.growDown(e,t):n?this.growRight(e,t):a?this.growDown(e,t):null},growRight:function(e,t){var a;return this.root={used:!0,x:0,y:0,width:this.root.width+e,height:this.root.height,down:this.root,right:{x:this.root.width,y:0,width:e,height:this.root.height}},(a=this.findNode(this.root,e,t))?this.splitNode(a,e,t):null},growDown:function(e,t){var a;return this.root={used:!0,x:0,y:0,width:this.root.width,height:this.root.height+t,down:{x:0,y:this.root.height,width:this.root.width,height:t},right:this.root},(a=this.findNode(this.root,e,t))?this.splitNode(a,e,t):null}},e.exports=a}])});var ajaxManager={setFirm:function(e){$(".map__info-content").css("opacity","0.5"),$.ajax({url:"/search/firm/"+e,type:"POST",success:function(t){$(".map__info-card, .frame__mover").remove(),$(".map__info").append(t),$(".map__info-card").show(400),$(".map__info-card").addClass("left-to-right"),userInterface.cardBlockRoll(),userInterface.setTitle(title),userInterface.setH1(h1),userInterface.setDescription(description),paramsManager.set("card",e),paramsManager.setUrl("card"),$(".map__info-list-item").removeClass("active"),$('[data-id="'+e+'"]').addClass("active"),mapManager.isYandexMap()&&mapManager.redrawPoints(),mapManager.setDefaultMarker(e),mapManager.setVisitMarker(e),$(".map__info-content").css("opacity","1"),userInterface.saveActiveFirm(e),jQuery(window).width()>800&&mapManager.moveMapTo(e,null,0);try{let e=jQuery(".map__info-card-rating").height()+jQuery(".map__info-card-title").height()+22;jQuery(".map__background").height(e)}catch(e){console.error(e)}},error:function(){return $(".map__info-content").css("opacity","1"),!1}})},setFilters:function(){$(".map__info-content").css("opacity","0.5");var e=paramsManager.getAll();e.city=City.url,$.ajax({url:"/search/ajax/"+paramsManager.getTextQuery(),type:"GET",data:e,success:function(e){$(".map__info-content").html(e),$(".map__info-content").css("opacity","1"),mapManager.redrawPoints(),userInterface.setTitle(title),userInterface.setH1(h1),userInterface.setDescription(description)},error:function(){return $(".map__info-content").css("opacity","1"),FirmList=[],userInterface.setCounters(),mapManager.redrawPoints(),!1}})},getPoints:function(e){var t=paramsManager.getAll();t.city=City.url,$.ajax({url:"/search/markers/"+paramsManager.getTextQuery(),type:"GET",data:t,success:function(t){FirmList=t,e(),userInterface.setCounters()},error:function(){return!1}})},liveSearch:function(e){City.id,$("#search-autocomplete").empty(),gisRegion?ajaxManager.gisSuggest(e):ajaxManager.getGisRegion(),$(".close-button").addClass("load")},getGisRegion:function(){$.ajax({url:"https://catalog.api.2gis.ru/2.0/region/search?q="+City.lon+","+City.lat+"&key=ruoedw9225",type:"GET",success:function(e){e&&e.result&&e.result.items&&(gisRegion=e.result.items[0])}})},gisSuggest:function(e){$.ajax({url:"https://catalog.api.2gis.ru/2.0/suggest/list?key=rutnpt3272&region_id="+gisRegion.id+"&locale=ru_RU&q="+e,type:"GET",success:function(e){var t="";$.each(e.result.items,function(e,a){var n=a.hint.text;t+='<li><a href="/'+City.url+"/поиск/"+n+'">'+n+"</a></li>"}),t="<ul>"+t+"</ul>",userInterface.liveSearchResult(t),$.post("/search/live",{result:e,city:City},function(){})}})}},authModule={login:function(e,t){$.ajax({processData:!1,url:path.ajaxLogin,type:"POST",dataType:"json",data:"login="+e+"&passwd="+t,success:function(e){console.log(e),e.error?authModule.showError(e.error):(messageManager.show("Авторизация прошла успешно"),$(".search__authblock").hide(),$(".login").unbind("click"),$("header .login").text("Личный кабинет"))}})},showError:function(e){userInterface.showMessage(e)},createUser:function(e){$.ajax({processData:!1,url:path.ajaxRegister,type:"POST",dataType:"json",data:"email="+e,success:function(t){console.log(t),t.error?authModule.showError(t.error):(userInterface.showMessage("Аккаунт "+e+" успешно создан. Пароль отправлен Вам на почту"),$(".simplemodal-close").click())}})},socialAuth:function(e,t){e=JSON.stringify(e),$.ajax({processData:!1,url:"/search/ajax_social_login",type:"POST",dataType:"json",data:"data="+e,success:function(e){e.error?authModule.showError(e.error):(userInterface.showMessage("Авторизация прошла успешно"),$(".simplemodal-close").click(),t&&setTimeout(function(){document.location=document.referrer},1e3))}})}},cookieManager={get:function(e){var t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return!!t&&decodeURIComponent(t[1])},set:function(e,t,a){var n=(a=a||{}).expires;if("number"==typeof n&&n){var r=new Date;r.setTime(r.getTime()+1e3*n),n=a.expires=r}n&&n.toUTCString&&(a.expires=n.toUTCString());var i=e+"="+(t=encodeURIComponent(t));for(var o in a){i+="; "+o;var s=a[o];!0!==s&&(i+="="+s)}document.cookie=i},delete:function(e){this.set(e,"",{expires:-1})}};$(document).ready(function(){var e={city:City.url,street:0,district:0,near:0,worktime:0,lat:0,lon:0,by_rating:0,by_title:0},t=$(".front-search-page").data("query"),a=new Date((new Date).getTime()+432e5),n=new Object;function r(){$(".firm_list").css("opacity","0.5"),$.ajax({url:"/search/front-ajax/"+t,type:"GET",data:e,success:function(e){$(".firm_list").html(e),$(".firm_list").css("opacity","1")},error:function(){return $(".firm_list").css("opacity","1"),!1}})}n.path="/",n.expires=a,$(".front-search-page .filter-select--js").on("change",function(){var t=$(this).val(),a=$(this).data("type");e[a]=t,r()}),$(".front-search-page .filter--js").on("click",function(){var t=$(this).val(),a=$(this).data("type");$(this).toggleClass("btn_active"),e[a]^=t,"near"==a&&e[a]?ymaps.geolocation.get({provider:"auto",mapStateAutoApply:!0}).then(function(t){var a=t.geoObjects;e.lat=a.position[0],e.lon=a.position[1],cookieManager.set("lat",a.position[0],n),cookieManager.set("lon",a.position[1],n),r()}):r()})});const KEY_ENTER=13,KEY_UP=38,KEY_DOWN=40,KEY_ESC=27;var userInterface={searchHistorySelect:function(e){var t=$("#search-autocomplete a").index($(".active")),a=$("#search-autocomplete a");if(a.removeClass("active"),27==e.keyCode&&($(".search__history ul").remove(),$("#search-form input").blur()),40==e.keyCode&&(t>=a.length-1&&(t-=a.length),t++,a.eq(t).addClass("active")),38==e.keyCode&&(--t<0&&(t+=a.length),a.eq(t).addClass("active")),13==e.keyCode&&t>=0){var n=a.eq(t).attr("href");document.location.href=n,$("#search-autocomplete").empty(),e.preventDefault()}},liveSearchResult:function(e){$("#search-autocomplete").html(e)},cardBlockRoll:function(){var e=$(".js-map__info-card"),t=e.find(".js-map__info-card-block-worktime"),a=e.find(".js-map__info-card-block-phone"),n=e.find(".map__info-card-trigger--close"),r=e.find(".map__info-card-trigger--roll, .on-map"),i=$(".map__info-header-trigger"),o=$(".js-map__info"),s=o.find(".map__info-header"),c=o.find(".map__info-content"),l=o.find(".map__info-card-icon"),u=o.find(".map__info-icon");t.click(function(){$(".contacts__info-wortime").slideToggle()}),a.click(function(){$(".map__info-card-block-phone").toggleClass("hide"),$(".map__info-card-block-notice").toggleClass("hide")}),n.click(function(){$(".frame__mover").remove(),e.hide(),i.show(),userInterface.setTitle(startTitle),paramsManager.clear("card"),paramsManager.setUrl("card")}),r.click(function(){$(".frame__mover").hide(),e.hide(),o.addClass("rolled"),s.hide(),c.hide(),l.show(),u.show()}),l.click(function(){o.removeClass("rolled"),$(".frame__mover").show(),s.show(),c.show(),l.hide(),u.hide(),e.show()}),e.find(".map__info-card-title a, .map__info-card-review-link--more").click(function(){userInterface.saveActiveFirm(localStorage.getItem("activeFirm"))})},cardHide:function(){$(".js-map__info-card, .frame__mover").hide()},slideCard:function(){var e=$(".frame__mover"),t=$(".js-map__info-card");e.hasClass("left")?e.html("&#10096;"):e.html("&#10097;"),t.toggleClass("left"),e.toggleClass("left")},setFilters:function(){var e=paramsManager.getAll();for(var t in e){var a=$("[data-type="+t+"]");paramsManager.get(t)==NO_CHECKED?(a.removeClass("active"),a.removeAttr("checked")):a.addClass("active")}userInterface.distanceButtons(),ajaxManager.setFilters()},setMyAddress:function(e){e&&$("#address").val(e)},setCounters:function(){$(".company-count span").each(function(){$(this).prop("Counter",0).animate({Counter:FirmList.length},{duration:100,easing:"swing",step:function(e){$(this).text(Math.ceil(e))}})})},refreshSelectFilters:function(){if(window.streets&&!paramsManager.get("street")){var e='<option value="0">Улица</option>';for(r=0;r<window.streets.length;++r){var t=window.streets[r];e+='<option value="'+t.url+'">'+t.name+"</option>"}$('select[data-type="street"]').html(e),jQuery('select[data-type="street"]').styler("destroy"),jQuery('select[data-type="street"]').styler()}if(window.districts&&!paramsManager.get("district")){for(e='<option value="0">Район</option>',r=0;r<window.districts.length;++r){var a=window.districts[r];e+='<option value="'+a.url+'">'+a.name+"</option>"}$('select[data-type="district"]').html(e),jQuery('select[data-type="district"]').styler("destroy"),jQuery('select[data-type="district"]').styler()}if(window.rubric_list&&!paramsManager.get("rubric")){for(e='<option value="0">Категория</option>',r=0;r<window.rubric_list.length;++r){var n=window.rubric_list[r];e+='<option value="'+n.id+'">'+n.name+"</option>"}$('select[data-type="rubric"]').html(e),jQuery('select[data-type="rubric"]').styler("destroy"),jQuery('select[data-type="rubric"]').styler()}if(window.tag_list&&!paramsManager.get("tag")){var r;for(e='<option value="0">Ключевое слово</option>',r=0;r<window.tag_list.length;++r){var i=window.tag_list[r];e+='<option value="'+i.id+'">'+i.name+"</option>"}$('select[data-type="tag"]').html(e),jQuery('select[data-type="tag"]').styler("destroy"),jQuery('select[data-type="tag"]').styler()}},setTitle:function(e){document.title=e},setH1:function(e){$("h1").text(e)},setDescription:function(e){document.querySelector('meta[name="description"]').setAttribute("content",e)},showMessage:function(e){e=$('<div class="popup-message">'+e+"</div>"),$(".l-page-container").append(e),e.slideDown(),setTimeout(function(){e.remove()},2e3)},distanceButtons:function(){$(".range").hide(),paramsManager.get("near")==CHECKED&&$(".range").show()},saveActiveFirm:function(e){localStorage.setItem("activeFirm",e),localStorage.setItem("activeFirmLink",document.location.href),localStorage.setItem("activeFirmExpire",+new Date+18e4)},onclickMapAny:function(){jQuery(window).width()<800&&jQuery(".on-map").click()}};!function(e,t){function a(e){var t={},a={type:"contentType",name:"query",withParents:"withParent"};for(var r in e.parentType&&e.parentId&&(t[e.parentType+"Id"]=e.parentId),e)n(e,r)&&e[r]&&(t[n(a,r)?a[r]:r]=e[r]);return t}function n(e,t){return e.hasOwnProperty(t)}function r(e){var a=t.console;a&&a.error&&a.error(e)}e.kladr={},function(){var a="https:"==t.location.protocol?"https:":"http:";e.kladr.url=a+"//kladr-api.ru/api.php"}(),e.kladr.type={region:"region",district:"district",city:"city",street:"street",building:"building"},e.kladr.typeCode={city:1,settlement:2,village:4},e.kladr.validate=function(t){var a=e.kladr.type;switch(t.type){case a.region:case a.district:case a.city:if(t.parentType&&!t.parentId)return r("parentId undefined"),!1;break;case a.street:if(t.parentType!=a.city&&t.parentType!=a.street)return r('parentType must equal "city" or "street"'),!1;if(!t.parentId)return r("parentId undefined"),!1;break;case a.building:if(!t.zip){if(!~e.inArray(t.parentType,[a.street,a.city]))return r('parentType must equal "street" or "city"'),!1;if(!t.parentId)return r("parentId undefined"),!1}break;default:if(!t.oneString)return r("type incorrect"),!1}return t.oneString&&t.parentType&&!t.parentId?(r("parentId undefined"),!1):t.typeCode&&t.type!=a.city?(r('type must equal "city"'),!1):!(t.limit<1)||(r("limit must greater than 0"),!1)},e.kladr.api=function(t,n){if(n)if(e.kladr.validate(t)){var i=setTimeout(function(){n([]),i=null},3e3);e.ajax({url:e.kladr.url+"?callback=?",type:"get",data:a(t),dataType:"jsonp"}).done(function(e){i&&(n(e.result||[]),clearTimeout(i))})}else n([]);else r("Callback undefined")},e.kladr.check=function(t,a){return a?(t.withParents=!1,t.limit=1,void e.kladr.api(t,function(e){a(!(!e||!e.length)&&e[0])})):void r("Callback undefined")}}(jQuery,window),function(e,t,a,n){function r(n,r){var i=function(){var t="kladr-data",a=n.data(t);return a||(a=e.extend({},s,c),n.data(t,a)),{set:function(e){if(e.obj)for(var r in e.obj)o(e.obj,r)&&o(s,r)&&(a[r]=e.obj[r]);else e.str&&!e.isGet&&o(s,e.str[0])&&(a[e.str[0]]=e.str[1]);n.data(t,a)},get:function(e){return o(s,e)||o(c,e)?a[e]:void 0},_set:function(e,r){a[e]=r,n.data(t,a)},_get:function(e){return o(a,e)?a[e]:void 0}}}();return function(e,t){return e.isGet?i.get(e.str[0]):(i.set(e),void t())}(r,function(){function r(){var e=n.offset(),t=n.outerWidth(),a=n.outerHeight();if(e&&(r.top!=e.top||r.left!=e.left||r.width!=t||r.height!=a)){r.top=e.top,r.left=e.left,r.width=t,r.height=a,$.css({top:e.top+a+"px",left:e.left});var i=$.outerWidth()-$.width();$.width(t-i);var o=b.width(),s=b.height();b.css({top:e.top+(a-s)/2-1,left:e.left+t-o-2})}}function c(t){if(!(t.which>8&&t.which<46)){if(n.data(I,!1),!f("open_before"))return void u();k(null);var a=n.val();if(!e.trim(a))return w(!1),void u();var i=_(a);if(!f("send_before",i))return void u();g(),f("send"),C("source")(i,function(t){return f("receive",t),n.is(":focus")?e.trim(n.val())&&t.length?(F=!0,function(t,a){var n,r,i,o;$.empty();for(var s=0;s<t.length;s++)n=t[s],r=C("valueFormat")(n,a),i=C("labelFormat")(n,a),(o=e('<a data-val="'+r+'">'+i+"</a>")).data("kladr-object",n),e("<li></li>").append(o).appendTo($)}(t,i),r(),v(),$.slideDown(50),void f("open")):(v(),k(null),function(){var t,a;$.empty(),null!=(t=s.noResultText)&&""!=t&&((a=e('<a data-val="">'+t+"</a>")).data("kladr-object",{}),e("<li></li>").append(a).appendTo($))}(),r(),$.slideDown(50),f("open"),void(F=!1)):(v(),void u())})}}function u(){f("close_before")&&($.empty().hide(),f("close"))}function d(e){var t=$.find("li.active");switch(e.which){case l.up:t.length?(t.removeClass("active"),t.prev().length&&(t=t.prev())):t=$.find("li").last(),function(){var e=$.scrollTop(),a=$.offset(),n=t.outerHeight();t.offset().top-a.top<0&&$.scrollTop(e-n)}(),t.addClass("active"),h();break;case l.down:t.length?(t.removeClass("active"),t.next().length&&(t=t.next())):t=$.find("li").first(),t.length&&function(){var e=$.scrollTop(),a=$.height(),n=$.offset(),r=t.outerHeight();t.offset().top-n.top+r>a&&$.scrollTop(e+r)}(),t.addClass("active"),h();break;case l.enter:u()}}function p(t){var a=e(t);a.is("a")&&(a=a.parents("li")),a.addClass("active"),h(),u()}function h(){if(f("select_before")){var e=$.find(".active a");e.length&&(n.val(e.attr("data-val")).data(I,!0),w(!1),k(e.data("kladr-object")),f("select",C("current")))}}function m(){function t(e,t){w(t),k(e)}if(C("verify")&&f("check_before")){var a=e.trim(n.val());if(!a)return void t(null,!1);if(C("current"))return void w(!1);var r=_(a);if(r.withParents=!1,r.limit=10,!f("send_before",r))return t(null,!1),void f("check",null);g(),f("send"),C("source")(r,function(a){function i(e,a){v(),t(e,a)}if(f("receive"),e.trim(n.val())){for(var o=r.name.toLowerCase(),s=null,c=0;c<a.length;c++)if(o==a[c].name.toLowerCase()){s=a[c];break}s&&n.val(C("valueFormat")(s,r)),i(s,!s),f("check",s)}else i(null,!1)})}}function f(t,a){if(!t)return!0;var r=t.replace(/_([a-z])/gi,function(e,t){return t.toUpperCase()});return n.trigger("kladr_"+t,a),"function"!==e.type(C(r))||!1!==C(r).call(n.get(0),a)}function g(){C("spinner")&&C("showSpinner")(b)}function v(){C("spinner")&&C("hideSpinner")(b)}function _(e){var t,a={},n=["token","key","type","typeCode","parentType","parentId","oneString","withParents","limit","strict"];for(t=0;t<n.length;t++)a[n[t]]=C(n[t]);a.name=M(e);var r,i=C("parentInput");return i&&((r=y(i,a.type))&&(a.parentType=r.type,a.parentId=r.id)),a.oneString&&(a.withParents=!0),a}function y(t,a){var n,r=e.kladr.getInputs(t),i=e.kladr.type,s={},c=null;for(n in r.each(function(){var t,a=e(this);(t=a.attr("data-kladr-id"))&&(s[a.attr("data-kladr-type")]=t)}),i){if(n==a)return c;o(i,n)&&s[n]&&(c={type:n,id:s[n]})}return c}function M(e){for(var t=e.toLowerCase(),a=0;a<t.length;a++)if(~"abcdefghijklmnopqrstuvwxyz".indexOf(t[a]))return w(!0),e;return w(!1),e}function k(e){var t=C("current");(t&&t.id)!==(e&&e.id)&&(x("current",e),e&&e.id?n.attr("data-kladr-id",e.id):n.removeAttr("data-kladr-id"),C("oneString")&&e&&e.contentType&&n.attr("data-kladr-type",e.contentType),f("change",e))}function w(e){e?n.addClass("kladr-error"):n.removeClass("kladr-error")}function C(e){return i._get(e)}function x(e,t){i._set(e,t)}var $=null,b=null,F=!1,E=".kladr",I="kladrInputChange";!function(i){var o=e(a.getElementById("kladr_autocomplete"));o.length||(o=e('<div id="kladr_autocomplete"></div>').appendTo(a.body));var s=C("guid");s?($=o.find(".autocomplete"+s),b=o.find(".spinner"+s),e(t).off(E),n.off(E),$.off(E)):(x("guid",s=function e(){return e.guid?++e.guid:e.guid=1}()),n.attr("autocomplete","off"),$=e('<ul class="autocomplete'+s+' autocomplete" style="display: none;"></ul>').appendTo(o),b=e('<div class="spinner'+s+' spinner" style="display: none;"></div>').appendTo(o),function(){function t(){n.attr(i,!0)}function a(e,t){e?n.val(C("valueFormat")(e,t)):w(!0),k(e),n.removeAttr(i)}var r={setValue:function(t){return"object"===e.type(t)?r.setValueByObject(t):"number"===e.type(t)?r.setValueById(t):"string"===e.type(t)?r.setValueByName(t):t?r:r.clear()},setValueByName:function(n){if(n=e.trim(n+"")){var i=_("");if(i.name=M(n),i.withParents=!1,i.limit=10,!f("send_before",i))return a(null,i),r;t(),f("send"),C("source")(i,function(e){f("receive");for(var t=i.name.toLowerCase(),n=null,r=null,o=0;o<e.length;o++)if(n=e[o].name.toLowerCase(),t==n){r=e[o];break}a(r,i)})}return r},setValueById:function(n){var i=_("");return i.parentType=i.type,i.parentId=n,i.limit=1,t(),e.kladr.api(i,function(e){e.length?a(e[0],i):a(null,i)}),r},setValueByObject:function(e){return a(e,_("")),r},clear:function(){return a(null,null),r}},i="data-kladr-autofill-lock";x("controller",r)}(),r(),function(){var t=0;!function a(){++t>5||function(){var t=n.val();if(t){var a=_(t),r=a.type,i=a.parentType,o=e.kladr.type,s=!0,c=C("controller").setValueByName;return r==o.street&&i!=o.city&&(s=!1),r!=o.building||~e.inArray(i,[o.street,o.city])||(s=!1),n.attr("data-kladr-autofill-lock")&&C("current")&&s&&c(t),!!C("current")}return!1}()||setTimeout(a,100)}()}()),i()}(function(){var a=!1,i=!0,o="";n.attr("data-kladr-type",C("type")||"").attr("data-kladr-one-string",C("oneString")||null).on("keyup"+E,c).on("keydown"+E,d).on("blur"+E,function(){!a&&n.data(I)&&o!=n.val()&&n.change()}).on("blur"+E+" change"+E,function(e){return a?void 0:("change"==e.type&&(o=n.val()),i&&(i=!1,m()),!F&&s.checkEmptyRespone&&n.val(""),u(),!1)}).on("focus"+E,function(){i=!0}),$.on("touchstart"+E+" mousedown"+E,"li, a",function(e){e.preventDefault(),a=!0,p(this),a=!1}),e(t).on("resize"+E,r)})})}function i(t,a){var r={obj:!1,str:!1,isGet:!1};return"object"===e.type(t)?(r.obj=t,r):("string"===e.type(t)&&(r.str=[t,a],r.isGet=a===n),r)}function o(e,t){return e.hasOwnProperty(t)}var s={token:null,key:null,type:null,typeCode:null,parentType:null,parentId:null,limit:10,oneString:!1,withParents:!1,noResultText:null,checkEmptyRespone:!1,strict:null,parentInput:null,verify:!1,spinner:!0,open:null,close:null,send:null,receive:null,select:null,check:null,change:null,openBefore:null,closeBefore:null,sendBefore:null,selectBefore:null,checkBefore:null,source:function(t,a){e.kladr.api(t,a)},labelFormat:function(t,a){var n;if(a.oneString)return t.parents?((n=[].concat(t.parents)).push(t),e.kladr.buildAddress(n)):(t.typeShort?t.typeShort+". ":"")+t.name;var r,i,o,s,c="";return t.typeShort&&(c+=t.typeShort+". "),i=(r=t.name).toLowerCase(),o=a.name.toLowerCase(),s=~(s=i.indexOf(o))?s:0,o.length<i.length?(c+=r.substr(0,s),c+="<strong>",c+=r.substr(s,o.length),c+="</strong>",c+=r.substr(s+o.length)):c+="<strong>"+r+"</strong>",c},valueFormat:function(t,a){var n;return a.oneString?t.parents?((n=[].concat(t.parents)).push(t),e.kladr.buildAddress(n)):(t.typeShort?t.typeShort+". ":"")+t.name:t.name},showSpinner:function(e){var t=-.2,a=setInterval(function(){return e.is(":visible")?(e.css("background-position","0% "+t+"%"),void((t+=5.555556)>95&&(t=-.2))):(clearInterval(a),void(a=null))},30);e.show()},hideSpinner:function(e){e.hide()}},c={current:null,controller:null},l={up:38,down:40,enter:13};e.kladr=e.extend(e.kladr,{setDefault:function(e,t){var a=i(e,t);if(a.obj)for(var n in a.obj)o(s,n)&&(s[n]=a.obj[n]);else a.str&&!a.isGet&&o(s,a.str[0])&&(s[a.str[0]]=a.str[1])},getDefault:function(e){return o(s,e)?s[e]:void 0},getInputs:function(t){var n=e(t||a.body),r="[data-kladr-type]";return n.filter(r).add(n.find(r))},setValues:function(t,a){var n,r,i="kladr_change.setvalues",s=e.kladr.type,c={},l=[];if(~e.inArray(e.type(t),["object","array"])){for(r in e.each(t,function(e,t){if(t){var a=t.contentType||t.type||e;o(s,a)&&(c[a]=t)}}),s)o(s,r)&&c[r]&&(l[r]=c[r]);n=e.kladr.getInputs(a),function e(){var t,a,r;for(a in l)if(o(l,a)){r=l[a],delete l[a];break}if(a)return(t=n.filter('[data-kladr-type="'+a+'"]')).length?void t.on(i,function(){t.off(i),e()}).kladr("controller").setValue(r):void e()}()}},getAddress:function(t,a){var n,r=e.kladr.getInputs(t),i=e.kladr.type,s={},c={};for(n in r.each(function(){var t,a,n,r=e(this);if(r.attr("data-kladr-id"))if(t=r.kladr("current"),r.attr("data-kladr-one-string")&&t.parents)for((a=[].concat(t.parents)).push(t),n=0;n<a.length;n++)s[a[n].contentType]=a[n];else s[r.attr("data-kladr-type")]=t;else s[r.attr("data-kladr-type")]=r.val()}),i)o(i,n)&&s[n]&&(c[n]=s[n]);return(a||e.kladr.buildAddress)(c)},buildAddress:function(t){var a=[],n="",r="";return e.each(t,function(t,i){var o,s="",c="";if("object"===e.type(i)){for(o=0;o<a.length;o++)if(a[o]==i.id)return;a.push(i.id),s=i.name,c=i.typeShort+". ",r=i.zip||r}else s=i;n&&(n+=", "),n+=c+s}),n=(r?r+", ":"")+n}}),e.fn.kladr=function(t,a){var n=i(t,a),o=null;return this.each(function(){var t=r(e(this),n);return n.isGet?(o=t,!1):void 0}),n.isGet?o:this}}(jQuery,window,document),function(e){e.fn.kladrZip=function(t){return this.keydown(function(t){var a=t.charCode||t.keyCode||0,n=8==a||9==a||13==a||46==a||110==a||190==a||a>=35&&40>=a||a>=96&&105>=a;return e(this).val().length>=6?n:n||a>=48&&57>=a}),this.keyup(function(){function a(e){e?n.addClass("kladr-error"):n.removeClass("kladr-error")}var n=e(this),r=n.val();return r?void e.kladr.api({type:e.kladr.type.building,zip:r,withParents:!0,limit:1},function(n){var r=n.length&&n[0];n=[],r?(a(!1),r.parents&&(n=n.concat(r.parents)),n.push(r),e.kladr.setValues(n,t)):a(!0)}):void a(!1)}),this}}(jQuery);var mapManager=function(){let e=!1,t=[],a=!1;var n,r,i,o,s=[],c=[];let l=0,u=function(e){var t=mapManager.getIndex(e);try{s.forEach(function(e,a){t==a&&(e.iconIndex=2)}),o.update()}catch(e){console.log("Ошибка "+e.message)}},d=function(e){o?e():t.push(e)};return{getMap:function(){return n},cbSetMapCreate:d,setFirmActive:function(e){e&&(l=e,window.userInterface.saveActiveFirm(e))},getCurrentPosition:function(){return n.getCenter()},createMap:function(){a=!1,$(".map__zoom-item.map__zoom-item--close").remove(),n=DG.map("sm",{center:paramsManager.getMapCenter()?paramsManager.getMapCenter():[City.lat,City.lon],zoom:paramsManager.get("zoom"),fullscreenControl:!1,zoomControl:!1}),isMob||paramsManager.getMapCenter()||n.fitBounds(n.getBounds(),{paddingTopLeft:[500,0]}),n.on("zoom",function(){}),n.on("zoomend",function(){paramsManager.set("center",[n.getCenter().lat,n.getCenter().lng]),paramsManager.setUrl("center"),paramsManager.set("zoom",n.getZoom()),paramsManager.setUrl("zoom")}),n.on("moveend",function(){paramsManager.set("center",[n.getCenter().lat,n.getCenter().lng]),paramsManager.setUrl("center"),paramsManager.set("zoom",n.getZoom()),paramsManager.setUrl("zoom")}),this.redrawPoints()},zoomPlus:function(){n.zoomIn(),mapManager.isYandexMap()&&r.setZoom(r.getZoom()+1,{duration:200,checkZoomRange:!0})},zoomMinus:function(){n.zoomOut(),mapManager.isYandexMap()&&r.setZoom(r.getZoom()-1,{duration:200,checkZoomRange:!0})},removeMyPosition:function(){i&&i&&i.remove()},createWay:function(e,t){$(".js-map__search-location").addClass("load"),$(".map__zoom-item--close").remove(),isMob?$(".zoom-map").append('<span class="map__zoom-item map__zoom-item--close">&#x274C;</span>'):$(".map__search-location-input-wrap").append('<span class="map__zoom-item map__zoom-item--close">&#x274C;</span>'),$(".map__info-content").css("opacity",.5),r?r.geoObjects.removeAll():(n.remove(),r=new ymaps.Map("sm",{center:[City.lat,City.lon],zoom:12,controls:[],behaviors:["default","scrollZoom"]})),ymaps.route([e,t],{mapStateAutoApply:!0}).then(function(e){r.geoObjects.add(e);var t=e.getWayPoints(),a=t.getLength()-1;t.options.set("preset","islands#redCircleIcon"),e.getPaths().options.set({strokeColor:"#ff0014"}),t.get(0).properties.set("iconContent","А"),t.get(a).properties.set("iconContent","Б"),e.editor.start({addWayPoints:!1,removeWayPoints:!0,editWayPoints:!0}),t.events.add("dragend",function(e){var t=e.get("target"),a=t.geometry.getCoordinates();ymaps.geocode(a,{results:1}).then(function(e){var a=e.geoObjects.get(0),n=City.name+", "+a.properties.get("name");"А"==t.properties.get("iconContent")?$("#address").val(n):$("#to").val(n)})}),$(".map__info-content").css("opacity",1),$(".js-map__search-location").removeClass("load")},function(e){$(".js-map__search-location").removeClass("load"),$(".map__info-content").css("opacity",1),messageManager.show("Возникла ошибка: "+e.message)}),userInterface.cardHide()},setPoints:function(e){if(mapManager.isYandexMap())return r.destroy(),r=!1,mapManager.createMap(),!0;try{o&&(s=[],o.remove());for(var i=0;i<FirmList.length;i++)s.push({position:[FirmList[i].lon,FirmList[i].lat],firmId:FirmList[i].id});var c=isMob?1:1.3;c=e||c;var u,d=new Image,p=new Image,h=new Image;d.src="/asset/search/images/1.svg",p.src="/asset/search/images/2.svg",h.src="/asset/search/images/3.svg",u=window.Atlas&&Atlas.Atlas?new Atlas.Atlas([{image:d,anchor:[.5,1],pixelDensity:c},{image:p,anchor:[.5,1],pixelDensity:c},{image:h,anchor:[.5,1],pixelDensity:c,size:[40,40]}]):new MarkerDrawer.Atlas([{image:d,anchor:[.5,1],pixelDensity:c},{image:p,anchor:[.5,1],pixelDensity:c},{image:h,anchor:[.5,1],pixelDensity:c,size:[40,40]}]),o=new MarkerDrawer.MarkerDrawer({bufferFactor:.5,zIndex:99999,onClickMarker:function(){mapManager.setActiveMarkerLast(),jQuery(window).width()>800&&setTimeout(()=>mapManager.moveMapTo(l,null,0),200)},onClickAny:function(){mapManager.setActiveMarkerLast(),userInterface.onclickMapAny()}}),!1===a&&t.map(e=>{e()}),a=!0,o.setAtlas(u),o.setMarkers(s),o.on("click",function(e){return l=s[e.marker].firmId,ajaxManager.setFirm(l),$(".map__info-filter").hide(),$(filterButton).removeClass("active"),!1}),o.on("mouseup",function(e){s[e.marker].iconIndex=1,o.update()}),o.on("mouseover",function(e){s[e.marker].iconIndex||(s[e.marker].iconIndex=1,o.update()),n.getContainer().style.cursor="pointer"}),o.on("mouseout",function(e){1===s[e.marker].iconIndex&&(s[e.marker].iconIndex=0,o.update()),n.getContainer().style.cursor="default"}),o.addTo(n),mapManager.drawMyPosition(!1)}catch(e){console.log("Ошибка "+e.message)}},redrawPoints:function(){ajaxManager.getPoints(mapManager.setPoints)},flyTo:function(e,t){n.flyTo(e,t,{duration:.3})},drawMyPosition:function(e){if(cookieManager.get("lat"))try{mapManager.removeMyPosition();var t=[cookieManager.get("lat"),cookieManager.get("lon")],a=DG.icon({iconUrl:"/asset/search/images/4.svg",iconSize:[30,30]});(i=DG.marker(t,{draggable:!0,icon:a}).addTo(n)).on("dragend",function(e){var t=e.target._latlng.lat.toFixed(20),a=e.target._latlng.lng.toFixed(20);geocodeManager.setCoordinates([t,a]),geocodeManager.setAddressByCoords([t,a]),paramsManager.get("near")&&ajaxManager.setFilters()}),i.addTo(n),e&&n.setView(t,14)}catch(e){console.log(e)}},setActiveMarker:u,setActiveMarkerLast:function(){u(l)},setDefaultMarker:function(e){try{var t=mapManager.getIndex(e);s.forEach(function(a,n){t==n&&e!=paramsManager.get("card")&&(a.iconIndex=0)}),o?o.update():d(()=>{o.update()})}catch(e){console.log("Ошибка "+e.message)}},setVisitMarker:function(e){var t=mapManager.getIndex(e);try{s.forEach(function(a,n){t==n?(c[e]&&$("#comment").val(c[e]),a.iconIndex=2):a.iconIndex=0}),o.update()}catch(e){console.log("Ошибка "+e.message)}},showMarker:function(e){var t=mapManager.getIndex(e),a=s[t];n.setView([a.position[1],a.position[0]],n.getZoom())},getIndex:function(e){return s.findIndex(function(t){return t.firmId==e})},isYandexMap:function(){return!!r},moveMapTo:function(t,a,r){if(e)return;var i=mapManager.getIndex(t),o=s[i];if(null===a&&(a=-460),!o)return!1;e=!0;let c=Y=0;c=o.position[1],Y=o.position[0],n.setView([c,Y],n.getZoom(),{animate:!1}),setTimeout(()=>{n.panBy(DG.point(a||0,r||0)),e=!1},200)},setFirmComment:function(e){var t=paramsManager.get("card"),a=mapManager.getIndex(t),r=s[a];c[t]=e;var i=DG.icon({iconUrl:"/asset/search/images/5.svg"});DG.marker([r.position[1],r.position[0]],{icon:i,opacity:0}).addTo(n).bindLabel(e,{static:!0,className:"gis-label"})}}}(),geocodeManager=function(){var e=new Date((new Date).getTime()+432e5),t=new Object;return t.path="/",t.expires=e,{setCoordinates:function(e){cookieManager.set("lat",e[0],t),cookieManager.set("lon",e[1],t)},getCoordinates:function(){return!!cookieManager.get("lat")&&[cookieManager.get("lat"),cookieManager.get("lon")]},getCurrentAddress:function(){return cookieManager.get("my_address")},setMyAddress:function(e){geocodeManager.setCoordsByAddress(e),cookieManager.set("my_address",e)},getMyPosition:function(e){$(".js-map__search-location").addClass("load"),ymaps.geolocation.get({provider:"auto",mapStateAutoApply:!0}).then(function(t){var a=t.geoObjects;geocodeManager.setCoordinates(a.position),geocodeManager.setAddressByCoords(geocodeManager.getCoordinates()),e&&e(),$(".js-map__search-location").removeClass("load")})},setCoordsByAddress:function(e){ymaps.geocode(e,{results:1}).then(function(e){var a=e.geoObjects.get(0).geometry.getCoordinates();cookieManager.set("lat",a[0],t),cookieManager.set("lon",a[1],t),mapManager.drawMyPosition(!0)})},setAddressByCoords:function(e){ymaps.geocode(e,{results:1}).then(function(e){var t=e.geoObjects.get(0),a=t.getLocalities(),n=City.name;a.length>0&&(n=a[0]),n=n+", "+t.properties.get("name"),cookieManager.set("my_address",n),userInterface.setMyAddress(n)})}}}(),CHECKED=1,NO_CHECKED=0,distance=[500,1e3,2e3,3e3],paramsManager=function(){document.getElementsByTagName("h1")[0].text;var e={};return e.page=NO_CHECKED,e.worktime=NO_CHECKED,e.workdays=NO_CHECKED,e.time=NO_CHECKED,e.is24x7=NO_CHECKED,e.street=NO_CHECKED,e.district=NO_CHECKED,e.site=NO_CHECKED,e.review=NO_CHECKED,e.photo=NO_CHECKED,e.rubric=NO_CHECKED,e.tag=NO_CHECKED,e.near=NO_CHECKED,e.by_title=NO_CHECKED,e.by_rating=NO_CHECKED,e.by_distance=NO_CHECKED,e.filial=NO_CHECKED,e.card=NO_CHECKED,e.distance=distance[1],e.attributes={},e.center,e.zoom=12,{clear:function(t){e[t]=NO_CHECKED,userInterface.setFilters()},setFromUrl:function(){for(var t,a=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),n=0;n<a.length;n++)"page"!=(t=a[n].split("="))[0]?paramsManager.set(t[0],t[1]):e.page=t[1]},setDefault:function(){for(var t in e)paramsManager.set(t,NO_CHECKED),paramsManager.clearUrl()},toggle:function(e){paramsManager.get(e)==NO_CHECKED?paramsManager.set(e,CHECKED):paramsManager.set(e,NO_CHECKED)},getAll:function(){return e},getTextQuery:function(){return $(".map__search-input-name").val()},setPage:function(t){e.page=t,paramsManager.setUrl("page")},toggleDay:function(t){e.workdays=t},set:function(t,a){return paramsManager.get(t)!=a&&(paramsManager.setPage(NO_CHECKED),e[t]=a)},toggleAtribute:function(t){e.attributes[t]?delete e.attributes[t]:e.attributes[t]=t},get:function(t){return e[t]},getMapCenter:function(){var t=e.center;return"string"==typeof t?t?t.split(","):"":t},setUrl:function(e){var t=[location.protocol,"//",location.host,location.pathname].join(""),a=document.location.search,n=paramsManager.get(e)!=NO_CHECKED?e+"="+paramsManager.get(e):"",r="?"+n;if(a){var i=new RegExp("([?&])"+e+"[^&]*");r=null!==a.match(i)?a.replace(i,"$1"+n):""!=n?a+"&"+n:a}var o=t+(r=r.replace(/&$/,""));o=o.replace(/\?$/,""),window.history.replaceState({},"",o)},clearUrl:function(){var e=[location.protocol,"//",location.host,location.pathname].join("");window.history.pushState("","",e)}}}(),isMob=window.innerWidth<=600,firmInList=".map__info-list-item",firmList=".map__info-content",fastFilter=".filter-item",attributes=".filter-attribute",distanceButton=".distance-button",pagerItem=".paging__item",clearFilters=".map__info-filter-clear",filterSelect=".filter-select",myPosition=".map__search-location",inputClear=".input-clear",positions=".map__search-location-input input",createWay=".get-way",workDay=".filter-by-days .map__info-filter-field-item",timeFilter=".filter-time",isOpen='[data-type="worktime"]',is24x7='[data-type="is24x7"]',searchForm="#search-form",searchFormClear=".close-button",printButton=".i-print",shareButton=".i-share",filterButton=".js-map__info-header-button-filter",closeButton=".map__info-header-trigger--close",firmAddress="#firm-address",firmFilials='[data-type="filial"]',back=".search__back",slideCard=".frame__mover",zoomPlus=".map__zoom-item--plus",zoomMinus=".map__zoom-item--minus",emtyResultLocation=".empty-result-location",liveSearchLinks=".search__history a",firmComment="#comment",firmComments=".kotel-review",yandexMapClose=".map__zoom-item.map__zoom-item--close";$(document).ready(function(){paramsManager.setFromUrl(),userInterface.cardBlockRoll(),setTimeout(()=>{jQuery("input#search").val()||jQuery("input#search").focus()},400),paramsManager.getTextQuery().search("рядом")>0&&setTimeout(function(){$('[data-type="near"]').click()},1e3),""==document.referrer&&$(back).hide(),DG.then(function(){mapManager.createMap(),suggestions()}),$(document).on("click",yandexMapClose,function(){mapManager.redrawPoints()}),$(document).on("click",firmComments,function(){$(".map__info-card-block-content--comments").fadeToggle()}),$(document).on("tap",".map__search-wrap.rolled",function(){$(this).removeClass("rolled")}),$(document).on("click",".map__search-wrap.rolled",function(){$(this).removeClass("rolled")}),$(firmList).bind("scroll",function(){$(".map__info-list").offset().top<0&&!$(".map__search-wrap").hasClass("rolled")?$(".map__search-wrap").addClass("rolled"):$(".map__info-list").offset().top>0&&$(".map__search-wrap").hasClass("rolled")&&$(".map__search-wrap").removeClass("rolled")}),$(document).on("click",liveSearchLinks,function(){document.location.href=$(this).attr("href")}),$(document).on("click",searchFormClear,function(){$("#search").val(""),$(this).hide()}),$(document).on("click",emtyResultLocation,function(){$(myPosition).click()}),$(document).on("click",zoomPlus,function(){mapManager.zoomPlus()}),$(document).on("click",zoomMinus,function(){mapManager.zoomMinus()}),$("ymaps, .map__info").click(function(){$(".map__region-list--full").hide()}),$(document).on("click",back,function(){history.back()}),$(document).on("click",slideCard,function(){userInterface.slideCard()}),$(document).on("submit",searchForm,function(e){var t=$(searchForm).find("input").val();t&&(window.location.href="/"+City.url+"/поиск/"+t),e.preventDefault()}),$(document).on("click",closeButton,function(){$(searchForm).find("input").val(""),$(".map__info,.map__region").remove(),FirmList=[],mapManager.redrawPoints(),userInterface.setH1("Поиск по сайту"),userInterface.setDescription("Поиск по сайту"),userInterface.setTitle("Поиск по сайту")}),$(document).on("click",firmFilials,function(e){e.preventDefault(),e.stopPropagation();var t=$(this).data("id");paramsManager.setDefault(),paramsManager.set("type","filial"),paramsManager.set("filial",t),paramsManager.setUrl("type"),paramsManager.setUrl("filial"),userInterface.setFilters()}),$(document).on("click",firmAddress,function(e){e.preventDefault(),userInterface.cardHide();var t=$(this).data("id");mapManager.setVisitMarker(t),mapManager.showMarker(t)}),$(document).on("click",firmInList+" .map__info-list-item-title",function(e){if($(this).parent().hasClass("category-item"))return window.location.href=$(this).attr("href"),!1;e.preventDefault()}),$(document).on("click",firmInList,function(){var e=$(this).data("id");ajaxManager.setFirm(e),$(".map__info-filter").hide(),$(filterButton).removeClass("active"),mapManager.setFirmActive(e),mapManager.setVisitMarker(e),mapManager.showMarker(e),jQuery(window).width()>1e3&&mapManager.moveMapTo(e,null,0)}),$(document).on("click",filterButton,function(){$(".map__info-card, .frame__mover").remove(),paramsManager.set("card",""),paramsManager.setUrl("card"),userInterface.setTitle(startTitle),userInterface.setH1(h1),userInterface.setDescription(startDescription)}),$(document).on("mouseenter",firmInList,function(){var e=$(this).data("id");mapManager.setActiveMarker(e)}),$(document).on("mouseleave",firmInList,function(){var e=$(this).data("id");mapManager.setDefaultMarker(e)}),$(document).on("click",distanceButton,function(){paramsManager.set("distance",$(this).data("distance")),userInterface.setFilters()}),$(document).on("click",attributes,function(){var e=$(this).data("id");paramsManager.toggleAtribute(e),userInterface.setFilters()}),$(document).on("click",fastFilter,function(){var e=$(this).data("type");let t=$(this).data("type-mode");if("near"!=e||t)$(this).data("type-mode",!1),mapManager.getMap().setView([localStorage.getItem("saveLat"),localStorage.getItem("saveLng")],localStorage.getItem("saveZoom")),paramsManager.toggle(e),userInterface.setFilters();else{$(this).data("type-mode",!0);const t=mapManager.getCurrentPosition();console.log(t),localStorage.setItem("saveLat",t.lat),localStorage.setItem("saveLng",t.lng),localStorage.setItem("saveZoom",mapManager.getMap().getZoom()),cookieManager.get("lat")?(paramsManager.toggle(e),userInterface.setFilters(),mapManager.drawMyPosition(!0)):geocodeManager.getMyPosition(function(){paramsManager.toggle(e),mapManager.drawMyPosition(!0),userInterface.setFilters()})}}),$(document).on("click",timeFilter,function(){if(!$(this).hasClass("active")){var e=$("#amount").val(),t=$(this).data("type"),a=(new Date).getDay()-1;$(".map__info-filter-field--days, .map__info-filter-field-slider").css("opacity",1),$(workDay).removeClass("active"),$(workDay+":eq("+a+")").addClass("active"),paramsManager.set("is24x7",NO_CHECKED),paramsManager.set("worktime",NO_CHECKED),paramsManager.set(t,e),paramsManager.toggleDay(a),userInterface.setFilters()}}),$(document).on("click",workDay,function(){if($(timeFilter).hasClass("active")){$(workDay).removeClass("active"),$(this).addClass("active");var e=$(this).index();paramsManager.set("is24x7",NO_CHECKED),paramsManager.set("worktime",NO_CHECKED),paramsManager.toggleDay(e),userInterface.setFilters()}}),$(document).on("click",isOpen+","+is24x7,function(){$(".map__info-filter-field--days, .map__info-filter-field-slider").css("opacity",.4),paramsManager.set("time",NO_CHECKED),paramsManager.set("workday",NO_CHECKED),$(timeFilter).removeClass("active"),$(workDay).removeClass("active")}),$(document).on("click",pagerItem,function(e){var t=$(this).text();$.isNumeric(t)&&(paramsManager.setPage(t),userInterface.setFilters()),e.preventDefault()}),$(document).on("click",clearFilters,function(){paramsManager.setDefault(),userInterface.setFilters(),userInterface.refreshSelectFilters()}),$(document).on("click",filterSelect,function(){var e=$(this).find(":selected").val(),t=$(this).data("type");paramsManager.set(t,e)&&("district"==t&&paramsManager.set("street",NO_CHECKED),userInterface.setFilters(),setTimeout(function(){userInterface.refreshSelectFilters(),mapManager.flyTo([FirmList[0].lat,FirmList[0].lon],13)},400))}),$(document).on("click",myPosition,function(){geocodeManager.getMyPosition(),mapManager.drawMyPosition(!0)}),$(document).on("click",inputClear,function(){$(this).parent().find("input").val(""),mapManager.redrawPoints()}),$(document).on("click",createWay,function(){var e=$(this).parents(".map__info-list-item, .map__info-card").find(".map__info-list-item-address, .map__info-card-block--address .map__info-card-block-content").text(),t=geocodeManager.getCoordinates()?geocodeManager.getCoordinates():geocodeManager.getCurrentAddress();return t?(geocodeManager.getCurrentAddress()?$("#address").val(geocodeManager.getCurrentAddress()):geocodeManager.setAddressByCoords(),mapManager.createWay(t,City.name+","+e)):geocodeManager.getMyPosition(function(){mapManager.createWay(geocodeManager.getCoordinates(),City.name+","+e)}),$("#to").val(e.replace(/\s+/g," ").trim()),$(".map__search-location-input--route.route-to").show(),isMob?$(".on-map").click():$(".map__search-location-input-wrap").show(),!1}),$(positions).keypress(function(e){if(13==e.keyCode){var t=$("#from").val();t=t||$("#address").val();var a=$("#to").val();a&&mapManager.createWay(t,a);var n=$("#address").val();geocodeManager.getCurrentAddress()!=n&&geocodeManager.setMyAddress(n),$(".map__search-location-input-wrap").hide()}}),$(searchForm).find("input").keyup(function(e){var t=$(this).val(),a=e.keyCode;0==t.length&&$(searchFormClear).hide(),1==t.length&&$(searchFormClear).show(),t.length>2&&40!=a&&38!=a&&27!=a&&13!=a?ajaxManager.liveSearch(t):userInterface.searchHistorySelect(e)}),$(searchForm).find("input").focusin(function(){var e=$(this).val();ajaxManager.liveSearch(e)}),$(searchForm).find("input").focusout(function(){setTimeout(function(){$(".search__history ul").remove()},200)}),$(document).on("click",printButton,function(){if(paramsManager.get("card")){var e=$(".map__info-card-review-link--more").attr("href");window.open(e+"?print","_blank").focus()}else window.print()}),$(document).on("click",shareButton,function(){$(".map__client-service #share").html('<script src="//yastatic.net/es5-shims/0.0.2/es5-shims.min.js"><\/script><script src="//yastatic.net/share2/share.js"><\/script><div class="ya-share2" data-services="vkontakte,facebook,odnoklassniki,twitter,viber,whatsapp,skype,telegram"></div>')}),$(document).on("focusout",firmComment,function(){var e=$(this).val();e&&mapManager.setFirmComment(e)}),$(document).on("click",".gis-label",function(e){var t=$(this),a=e.pageY-t.offset().top;a>1&&a<10&&t.remove()})});var startTitle=document.title,startDescription=document.description,h1=document.getElementsByTagName("h1")[0].text;isMob=window.innerWidth<=600;function suggestions(){var e="",t="594a4e1d0a69de473f8b4569",a=5;function n(e){var t=e.typeShort+". "+e.name;if(e.parents)for(var a=e.parents.length-1;a>-1;a--){var n=e.parents[a];n.name&&"city"==n.contentType&&(t=n.name+", "+t)}return t}e||setTimeout(function(){$.ajax({type:"GET",crossDomain:!0,dataType:"jsonp",url:"https://kladr-api.ru/api.php",data:{token:t,limit:1,contentType:"city",query:City.name},success:function(r){e=r.result[0],$("#from").kladr({oneString:!0,token:t,limit:a,parentId:e.id,parentType:e.contentType,regionId:e.id,withParent:!0,oneString:!0,type:"street",labelFormat:function(e){return n(e)},valueFormat:function(e){return n(e)}}),$("#to").kladr({oneString:!0,token:t,limit:a,parentId:e.id,parentType:e.contentType,regionId:e.id,withParent:!0,oneString:!0,type:"street",labelFormat:function(e){return n(e)},valueFormat:function(e){return n(e)}}),$("#address").kladr({oneString:!0,token:t,limit:a,parentId:e.id,type:"street",parentType:e.contentType,regionId:e.id,withParent:!0,oneString:!0,labelFormat:function(e){return n(e)},valueFormat:function(e){return n(e)}})}})},2e3)}function ucall(e){$.getJSON("//ulogin.ru/token.php?host="+encodeURIComponent(location.toString())+"&token="+e+"&callback=?",function(e){(e=$.parseJSON(e.toString())).error?userInterface.showMessage("Ошибка авторизации"):authModule.socialAuth(e,!0)})}